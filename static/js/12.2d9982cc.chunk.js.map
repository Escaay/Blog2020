{"version":3,"sources":["pages/message/index.js"],"names":["TextArea","Message","React","useState","userName","setUserName","HasLogin","setHasLogin","PubSub","subscribe","title","data","messageContent","setMessageContent","text","setText","loveBgc","setloveBgc","updateData","callback","axios","get","then","res","reverse","err","console","log","useEffect","className","rows","onChange","e","target","value","type","onClick","post","qs","stringify","username","message","alert","LeaveMessage","block","map","item","index","id","twoToneColor","style","backgroundColor","love"],"mappings":"wTAOQA,E,IAAAA,SACO,SAASC,IAAW,IAAD,EACHC,IAAMC,SAAS,IADZ,mBACzBC,EADyB,KAChBC,EADgB,OAEHH,IAAMC,UAAS,GAFZ,mBAEzBG,EAFyB,KAEhBC,EAFgB,KAS9BC,IAAOC,UAAU,YAHI,SAACC,EAAMC,GACxBJ,EAAYI,MAGhBH,IAAOC,UAAU,YAPI,SAACC,EAAMC,GACxBN,EAAYM,MAJc,MAWWT,IAAMC,SAAS,IAX1B,mBAWvBS,EAXuB,KAWRC,EAXQ,OAYTX,IAAMC,SAAS,IAZN,mBAYvBW,EAZuB,KAYlBC,EAZkB,OAaHb,IAAMC,SAAS,IAbZ,mBAavBa,EAbuB,KAafC,EAbe,KAcxBC,EAAW,SAACC,GACdC,IAAMC,IAAI,qCAAqCC,MAAK,SAAAC,GAChDV,EAAkBU,EAAIZ,KAAKa,WAC3BL,OAEJ,SAAAM,GACIC,QAAQC,IAAI,gCAoDpB,OATAzB,IAAM0B,WAAU,WACZR,IAAMC,IAAI,qCAAqCC,MAAK,SAAAC,GAChDV,EAAkBU,EAAIZ,KAAKa,cAE/B,SAAAC,GACIC,QAAQC,IAAI,6CAAUF,QAG5B,IAEE,sBAAKI,UAAU,UAAf,UACI,sBAAMA,UAAU,gBAAhB,UACF,cAAC7B,EAAD,CAAU8B,KAAM,EAAIC,SAnDT,SAACC,GACdjB,EAAQiB,EAAEC,OAAOC,QAkD2BA,MAAOpB,IACjD,mBAAQqB,KAAK,UAAUC,QAAS,YAjDnB,SAACtB,GACZR,EAIM,KAAPQ,EACCM,IAAMiB,KAAK,oCAAoCC,IAAGC,UAAU,CAACC,SAASpC,EAASqC,QAAQ3B,KAAQQ,MAAK,WAChGoB,MAAM,4BACNxB,GAAW,WAAKH,EAAQ,UAE5B,SAAAU,GACIiB,MAAM,+BAIVA,MAAM,wCAbNA,MAAM,4BA+C6BC,CAAa7B,IAAQe,UAAU,aAAae,OAAK,EAAtF,yCAKA,uBACA,uBACA,6BAEIhC,EAAeiC,KAAI,SAACC,EAAKC,GACrB,OACA,6BACd,sBAAKlB,UAAU,kBAAf,UACA,sBAAKA,UAAU,uBAAf,UAAuCiB,EAAKN,SAA5C,YACD,qBAAKX,UAAU,uBAAf,SAAuCiB,EAAKL,UAC5C,sBAAKZ,UAAU,eAAf,UAA8B,sBAAMO,QAAS,WA9C5B,IAACY,IA8C0CF,EAAKE,GA7C/C,KAAVhC,GACCC,EAAW,OACXG,IAAMC,IAAN,mDAAsD2B,EAAtD,sBAA6E1B,MAAK,WAC9EJ,GAAW,kBACb,SAAAO,GACEiB,MAAM,iCAGVzB,EAAW,IACXG,IAAMC,IAAN,mDAAsD2B,EAAtD,sBAA6E1B,MAAK,SAAAC,GAC9EL,GAAW,kBACb,SAAAO,GACEiB,MAAM,6CAiCW,SAAyC,cAAC,IAAD,CAAcO,aAAa,UAAUC,MAAO,CAACC,gBAAgBnC,OAApI,IAAwJ8B,EAAKM,YAJrIL","file":"static/js/12.2d9982cc.chunk.js","sourcesContent":["import React from 'react'\r\nimport './index.css'\r\nimport { Input,Button } from 'antd';\r\nimport axios from 'axios'\r\nimport {HeartTwoTone} from '@ant-design/icons';\r\nimport qs from 'querystring'\r\nimport PubSub from 'pubsub-js'\r\nconst { TextArea } = Input;\r\nexport default function Message() {\r\n    let [userName,setUserName]=React.useState('')\r\n    let [HasLogin,setHasLogin]=React.useState(false)\r\n    const handleHasLogin=(title,data)=>{\r\n        setUserName(data)\r\n    }\r\n    const handleUserName=(title,data)=>{\r\n        setHasLogin(data)\r\n    }\r\n    PubSub.subscribe('UserName',handleUserName)\r\n    PubSub.subscribe('HasLogin',handleHasLogin)\r\n    const [messageContent,setMessageContent]=React.useState([])\r\n    const [text,setText]=React.useState('')\r\n    const [loveBgc,setloveBgc]=React.useState('')\r\n    const updateData=(callback)=>{\r\n        axios.get('http://aays.top:4000/board/search').then(res=>{\r\n            setMessageContent(res.data.reverse())\r\n            callback()\r\n        },\r\n        err=>{\r\n            console.log('查询失败');\r\n        }\r\n        )\r\n    }\r\n    const textChange=(e)=>{\r\n        setText(e.target.value)\r\n    }\r\n    const LeaveMessage=(text)=>{\r\n        if(!HasLogin){\r\n            alert('请先登录')\r\n            return \r\n        }\r\n        if(text!==''){\r\n            axios.post('http://aays.top:4000/board/insert',qs.stringify({username:userName,message:text})).then(()=>{\r\n                alert('留言成功')\r\n                updateData(()=>{setText('')})\r\n            },\r\n            err=>{\r\n                alert('留言失败')\r\n            }\r\n            ) \r\n        }else{\r\n            alert('输入不能为空')\r\n        }\r\n    }\r\n    const Clicklove=(id)=>{\r\n        if(loveBgc===''){\r\n            setloveBgc('red')\r\n            axios.get(`http://aays.top:4000/board/updatelove?id=${id}&option=increment`).then(()=>{\r\n                updateData(()=>{})\r\n            },err=>{\r\n                alert('点赞失败');\r\n            })\r\n        }else{\r\n            setloveBgc('')\r\n            axios.get(`http://aays.top:4000/board/updatelove?id=${id}&option=decrement`).then(res=>{\r\n                updateData(()=>{})\r\n            },err=>{\r\n                alert('取消点赞失败')\r\n            })\r\n        }\r\n    }\r\n   \r\n    React.useEffect(()=>{\r\n        axios.get('http://aays.top:4000/board/search').then(res=>{\r\n            setMessageContent(res.data.reverse())\r\n        },\r\n        err=>{\r\n            console.log('请求数据库失败',err);\r\n        }\r\n        )\r\n    },[])\r\n    return (\r\n        <div className='message'>\r\n            <div  className='message-input'>\r\n          <TextArea rows={5}  onChange={textChange} value={text}/>\r\n          <Button type=\"primary\" onClick={()=>{LeaveMessage(text)}} className='search-btn' block>\r\n      发表留言\r\n    </Button>\r\n          </div>\r\n    \r\n          <br />\r\n          <br />\r\n          <ul>\r\n          {\r\n              messageContent.map((item,index)=>{\r\n                  return (\r\n                  <li key={index}>\r\n    <div className='message-content'>\r\n    <div className='message-content-user'>{item.username}：</div>\r\n   <div className='message-content-text'>{item.message}</div>\r\n   <div className='message-love'><span onClick={()=>{Clicklove(item.id)}}><HeartTwoTone twoToneColor=\"#eb2f96\" style={{backgroundColor:loveBgc}}/></span> {item.love}</div>\r\n</div>\r\n                  </li>\r\n                  )\r\n              })\r\n          }\r\n      </ul>\r\n        </div>\r\n    )\r\n}\r\n"],"sourceRoot":""}